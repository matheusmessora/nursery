<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Machines</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <style media="all" type="text/css">
        canvas{
            width: 100% !important;
            max-width: 800px;
            height: auto !important;
        }

    </style>

    <script>

        // Load the Visualization API library and the piechart library.
        google.load('visualization', '1.0', {'packages':['corechart', 'gauge']});


        function loadMetric(id){
            // Create the data table.
            var gData = new google.visualization.DataTable();
            gData.addColumn('datetime', 'time');
            gData.addColumn('number', 'point');




            $.getJSON("/api/metric/" +id+ "?load=true", {format: "json"})
                    .done(function (metric) {

                        var title = metric.name;

                        $.each(metric.datas, function (index, data) {

                            var x = new Date(data.date_creation);
                            var y = data.value;

                            gData.addRow([x, y]);
                        });

                        console.log(metric);
                        var options = {
                            title: title,
                            vAxis: {minValue: 0, maxValue: metric.max_value}
                        };

                        // Instantiate and draw our chart, passing in some options.
                        var chart = new google.visualization.AreaChart(document.getElementById('chartContainer' + id));
                        chart.draw(gData, options);
                    });
        }

        function loadGauge(id){
            // Create the data table.

            $.getJSON("/api/metric/" +id+ "?load=true", {format: "json"})
                    .done(function (metric) {
                        var title = metric.name;

                        var gData = new google.visualization.arrayToDataTable([
                            ['Label', 'Value'],
                                [title, 0]
                        ]);

                        $.each(metric.datas, function (index, data) {

                            var x = new Date(data.date_creation);
                            var y = data.value;

                            gData.setValue(0, 1, y);
                        });

                        console.log(metric);
                        var options = {
                            width: 400, height: 120,
                            redFrom: 90, redTo: 100,
                            yellowFrom:75, yellowTo: 90,
                            minorTicks: 5
                        };

                        // Instantiate and draw our chart, passing in some options.
                        var chart = new google.visualization.Gauge(document.getElementById('gaugeContainer' + id));
                        chart.draw(gData, options);
                    });
        }
    </script>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            UNIVERSO :: Machines :: <span th:text="${monitor.machine} + ' :: ' + ${monitor.name}">a1-hunf</span>
        </div>
        <div class="col-lg-12" th:each="metric : ${monitor.metrics}">
            <span th:text="${metric.id}"></span>
            <div th:attr="id='chartContainer'+${metric.id}" style="height: 300px; width: 100%;">
                <script type="text/javascript" th:inline="javascript" >
                    var id = [[${metric.id}]];
                    loadMetric(id);
                </script>
             </div>

        </div>
        <div class="col-lg-4" th:each="metric : ${monitor.metrics}">
            <span th:text="${metric.id}"></span>
            <div th:attr="id='gaugeContainer'+${metric.id}" style="height: 300px; width: 100%;">
                <script type="text/javascript" th:inline="javascript" >
                    var id = [[${metric.id}]];
                    loadGauge(id);
                </script>
             </div>

        </div>
    </div>
</div>
</body>
</html>
