<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Machines</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <link href='http://fonts.googleapis.com/css?family=Roboto:400,500,700,300,400italic' rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="/resources/main.css" />

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>


    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <style media="all" type="text/css">
        canvas{
            width: 100% !important;
            max-width: 800px;
            height: auto !important;
        }

    </style>

    <script>

        // Load the Visualization API library and the piechart library.
        google.load('visualization', '1.0', {'packages':['corechart', 'gauge']});


        function loadMetric(id){
            // Create the data table.
            var gData = new google.visualization.DataTable();
            gData.addColumn('datetime', 'time');
            gData.addColumn('number', 'point');


            $.getJSON("/api/metric/" +id+ "?load=true", {format: "json"})
                    .done(function (metric) {

                        var title = metric.name;

                        $.each(metric.datas, function (index, data) {

                            var x = new Date(data.date_creation);
                            var y = data.value;

                            gData.addRow([x, y]);
                        });

                        console.log(metric);
                        var options = {
                            title: title,
                            fontName: 'Roboto',
                            vAxis: {minValue: 0, maxValue: metric.max_value, baselineColor: "#FFFFFF", gridlines: {color: "#cccccc", count: 5}},
                            hAxis: {baselineColor: "#FFFFFF", gridlines: {color: "#FFF", count: 5}},
                            legend: 'none',
                            theme: 'maximized'

                        };

                        // Instantiate and draw our chart, passing in some options.
                        var chart = new google.visualization.AreaChart(document.getElementById('chartContainer' + id));
                        chart.draw(gData, options);
                    });
        }

    </script>
</head>
<body>
<div id="side_menu" class="material">
    <div class="container">
        <ul class="navigation">
            <li><a><i class="glyphicon glyphicon-globe"></i> Welcome to UNIVERSO</a></li>
            <li class="active"><a href="/machines"><i class="glyphicon glyphicon-home"></i> Home</a></li>
            <li><a href="/machines"><i class="glyphicon glyphicon-th"></i> Infrastructure</a></li>
        </ul>
    </div>
</div>
<div class="container-fluid">
    <div class="col-lg-12 material-header">
        <h3>UNIVERSO :: <a href="/machines">Machines</a> :: <a th:href="@{/machine(uid=${monitor.machine})}" th:text="${monitor.machine}">localhost</a> :: <span th:text="${monitor.name}"></span></h3>
    </div>
    <div th:each="metric : ${monitor.metrics}">
        <div class="col-lg-3 material">
            <div th:attr="id='chartContainer'+${metric.id}" style="height: 150px; width: 100%;">
                <script type="text/javascript" th:inline="javascript" >
                    var id = [[${metric.id}]];
                    loadMetric(id);
                </script>
             </div>
        </div>
    </div>
</div>
</body>
</html>
