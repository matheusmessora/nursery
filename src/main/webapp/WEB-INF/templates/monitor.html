<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Machines</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />


    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

    <script src="/canvasjs/canvasjs.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>


    <script>
        function loadMetric(id){
            $.getJSON("/api/metric/" +id+ "?load=true", {format: "json"})
                    .done(function (metric) {
                        // console.log(metric);
                        // console.log(metric.datas);

                        var dataPoints = [];
                        var title = metric.name;
                        $.each(metric.datas, function (index, data) {
                            // console.log(data);

                            var x = new Date(data.date_creation);
                            var y = data.value;

                            dataPoints.push({x: x, y: y});


                            // var jsonData = JSON.parse(data);
                            // console.log(jsonData);
                            // var ponto = {
                            //   x: new Date(jsonData.date_creation),
                            //   y: jsonData.value
                            // }

                        });
                        var chart = new CanvasJS.Chart("chartContainer" + id, {

                            title: {
                                text: metric.name
                            },
                            data: [
                                {
                                    type: "area",
                                    name: title,
                                    axisX: {
                                        valueFormatString: "mm:ss"
                                    },
                                    axisY: {
                                        minimum:0,
                                        maximum: 100
                                    },
                                    dataPoints: dataPoints
                                }
                            ]

                        });
                        chart.render();


                    });
        }
    </script>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            UNIVERSO :: Machines :: <span th:text="${monitor.name}">a1-hunf</span>
        </div>
        <div class="col-lg-12" th:each="metric : ${monitor.metrics}">
            <span th:text="${metric.id}"></span>
            <div th:attr="id='chartContainer'+${metric.id}" style="height: 300px; width: 100%;">
                <script type="text/javascript" th:inline="javascript" >
                    var id = [[${metric.id}]];
                    loadMetric(id);
                </script>

            </div>
        </div>
    </div>
</div>

<!--<div th:each="machine : ${machines}" style="margin-bottom: 30px; display: block;">-->

    <!--<div th:text="${machine.key}"></div>-->

    <!--<tr th:each="monitor : ${machine.value}">-->
        <!--<td th:text="${monitor.name}">The first name</td>-->
    <!--</tr>-->
<!--</div>-->
</body>
</html>
